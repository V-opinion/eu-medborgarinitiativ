"use strict";function getReviewData(e){displaySpinner(),jQuery.ajax({method:"GET",headers:{"X-API-Key":e,"X-API-Version":1},url:"https://djpsoftware.azurewebsites.net/api/reviews",dataType:"json"}).done((function(e){removeSpinner(),addReviews(e)})).fail((function(){removeSpinner(),displayMessage("Currently unable to display reviews. Please check again later")}))}function postReviewData(e){displaySpinner();let a=document.getElementsByClassName("review-wrapper")[0].dataset.customerId;jQuery.ajax({method:"POST",headers:{"X-API-Key":a,"X-API-Version":1},url:"https://djpsoftware.azurewebsites.net/api/reviews",dataType:"json",contentType:"application/json",data:JSON.stringify(e),statusCode:{201:function(){removeSpinner(),displayMessage("Thank you! Your review will be displayed on successful completion of the approval process")}}}).fail((function(){removeSpinner(),displayMessage("Please try again later. Please only submit one review for each purchase")}))}function addReviews(e){let a=[];for(const i of getSortedReviews(e)){let e=i.firstName,t=i.lastName,s=i.rating,l=i.review,o=i.anonDisplay,r="";for(let e=0;e<s;e++)r+='<i class="fa fa-star"></i>';let n=document.getElementsByClassName("review-wrapper")[0].dataset.companyName+" Customer";0==o&&(n=e+" "+t);let d="";if("true"==document.getElementsByClassName("review-wrapper")[0].dataset.showReviewDates){d=`<span class="text-muted"> ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][i.reviewDate.getMonth()]} ${i.reviewDate.getFullYear()}</span>`}a.push('<div class="col"><div class="card"><div class="card-body"><p class="card-text">'+l+" - "+n+"<br /><span />"+r+"</span>"+d+"</p></div></div></div>")}jQuery(".feedback #reviewList").removeClass("d-none"),jQuery(".feedback #reviewList").append('<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">'+a.reduce(((e,a)=>e+a))+"</div>")}function getSortedReviews(e){let a;a="getAdditionalReviews"==document.getElementsByClassName("review-wrapper")[0].dataset.additionalReviews?e.reviews.concat(getAdditionalReviews()):e.reviews;let i=a.map((e=>({firstName:e.firstName,lastName:e.lastName,rating:e.rating,review:e.review,anonDisplay:e.anonDisplay,reviewDate:new Date(e.reviewDate)}))),t=[];return t="ascending"==document.getElementsByClassName("review-wrapper")[0].dataset.sortReviewDates?i.sort(((e,a)=>Number(e.reviewDate)-Number(a.reviewDate))):i.sort(((e,a)=>Number(a.reviewDate)-Number(e.reviewDate))),t}function displayMessage(e){jQuery(".feedback #message").text(e)}function displaySpinner(){jQuery(".feedback #waitingIcon").addClass("fas fa-sync fa-spin")}function removeSpinner(){jQuery(".feedback #waitingIcon").removeClass("fas fa-sync fa-spin")}jQuery(document).ready((function(){if(jQuery(".review-wrapper").length){let e='<h3>Reviews</h3><p>Please leave us a review by clicking on the button below. We welcome your feedback. Thank you!</p><div class="modal fade" role="dialog" tabindex="-1" id="addReview"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h3>Add Review</h3><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><p>Please fill in the details below to submit your review. If you prefer your name not to be displayed you can check the \'Display anonymously\' box.&nbsp;Thank you!&nbsp;<br></p></div><form><div class="form-group mb-3"><label class="form-label">First Name</label><input class="form-control" type="text" id="firstName" maxlength="50"></div><div class="form-group mb-3"><label class="form-label">Last Name</label><input class="form-control" type="text" id="lastName" maxlength="50"></div><div class="form-group mb-3"><label class="form-label">Email address</label><input class="form-control" type="email" id="email"></div><div class="form-group mb-3"><select class="form-select" id="rating"><option value="0" selected="">Please enter your rating</option><option value="1">*</option><option value="2">**</option><option value="3">***</option><option value="4">****</option><option value="5">*****</option></select></div><div class="form-group mb-3"><label class="form-label">Review</label><textarea class="form-control" id="review" rows="3" maxlength="2000"></textarea></div><div class="form-group mb-3"><div class="form-check"><input class="form-check-input" type="checkbox" id="anonDisplay"><label class="form-check-label" for="anonDisplay">Display anonymously</label></div></div></form><div class="modal-footer"><button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button><button class="btn btn-primary" id="submitReview" type="button">Submit</button></div></div></div></div><div><button class="btn btn-primary mb-4" type="button" data-bs-toggle="modal" data-bs-target="#addReview">Add Review</button></div><div class="feedback"><div id="waitingIcon"></div><p id="message"></p><div class="d-none" id="reviewList"></div></div>';jQuery(".review-wrapper").append(e),getReviewData(document.getElementsByClassName("review-wrapper")[0].dataset.customerId)}})),jQuery(".review-wrapper").on("click","#addReview #submitReview",(function(){let e=jQuery("#addReview #firstName").val(),a=jQuery("#addReview #lastName").val(),i=jQuery("#addReview #email").val(),t=jQuery("#addReview #rating").val(),s=jQuery("#addReview #review").val(),l=jQuery("#addReview #anonDisplay").prop("checked");if(""==e||""==a||""==i||0==t||""==s)alert("Please complete all fields before submitting your review");else{var o={firstName:e,lastName:a,email:i,rating:t,review:s,anonDisplay:l};jQuery("#addReview").modal("hide"),jQuery("#addReview #firstName").val(""),jQuery("#addReview #lastName").val(""),jQuery("#addReview #email").val(""),jQuery("#addReview #rating").val(""),jQuery("#addReview #review").val(""),jQuery("#addReview #anonDisplay").prop("checked",!1),postReviewData(o)}}));